# PRD 생성 기능 개선 완료 보고서

**작성일**: 2025년 12월 3일  
**상태**: 완료 ✅

---

## ✅ 완료된 개선 사항

### 1. 프롬프트 개선

#### 1.1 섹션별 체크리스트 제공
**문제**: 이전 부분의 전체 내용(5000자)을 참고하지만, AI가 중복 섹션을 생성  
**해결**: 
- 이전 부분의 전체 내용 대신 **작성된 섹션 목록**만 제공
- `extractWrittenSections()` 함수로 섹션 목록 추출
- `extractWrittenMermaidDiagrams()` 함수로 다이어그램 목록 추출
- 각 Part별로 작성할 섹션 번호 명확히 지정

**효과**:
- AI가 이미 작성된 섹션을 명확히 인지
- 중복 섹션 생성 방지
- 더 정확한 섹션별 작성 가이드

#### 1.2 Mermaid 다이어그램 제한 강화
**문제**: 
- 다이어그램이 잘리고 스크롤 발생
- 다이어그램 사이즈가 너무 큼
- 중복 다이어그램 생성

**해결**:
- 노드 개수: **8개 → 6개**로 축소
- 노드 텍스트: **10자 → 8자**로 축소
- 레벨(깊이): **3단계 → 2단계**로 축소
- 다이어그램은 **Part 6에서만 한 번만** 작성하도록 명시
- 이전 부분에 이미 다이어그램이 있으면 새로 작성하지 않도록 지시

**효과**:
- 화면에 잘 맞는 다이어그램 생성
- 스크롤 없이 전체 구조를 한눈에 볼 수 있음
- 중복 다이어그램 방지

#### 1.3 섹션 번호 관리 명확화
**문제**: 섹션 번호가 뒤엉키고 중복됨  
**해결**:
- 각 Part별로 작성할 섹션 번호를 명확히 지정
  - Part 1: `### 1. 프로젝트 개요`만 작성
  - Part 2: `### 2. 사용자 스토리`만 작성
  - Part 3: `### 3. 기능 명세`만 작성
  - Part 4: `### 4. 화면 설계`만 작성
  - Part 5: `### 5. 기술 요구사항`만 작성
  - Part 6: `### 6. 프로젝트 구조`만 작성
  - Part 7: `### 6. 성공 지표`만 작성
- 다른 섹션은 작성하지 않도록 명시

**효과**:
- 섹션 번호 일관성 유지
- 중복 섹션 방지

#### 1.4 문서 완성도 확인 강화
**문제**: 문서가 중간에 끊기거나 불완전한 문장으로 끝남  
**해결**:
- Part 7에서 문서 완성도 확인 강화
- 불완전한 문장 패턴 명시
- 마무리 문장 예시 제공
- "## 완료 조건", "## 다음 단계", "## 참고 자료" 중 하나로 마무리하도록 지시

**효과**:
- 완전한 문서 생성
- 불완전한 문장 방지

---

### 2. 병합 로직 개선

#### 2.1 섹션 번호 정규화
**구현**: `normalizeSectionNumbers()` 함수 추가
- 다양한 패턴의 섹션 번호를 정규화
- 섹션 번호 일관성 유지

**효과**:
- 섹션 번호 뒤엉킴 방지
- 일관된 문서 구조

#### 2.2 Mermaid 다이어그램 중복 제거 강화
**구현**: `removeDuplicateMermaidDiagrams()` 함수 추가
- 유사도 기반 중복 감지 (Jaccard 유사도 사용)
- 80% 이상 유사하면 중복으로 간주
- 첫 번째 다이어그램만 유지

**효과**:
- 중복 다이어그램 완전 제거
- 유사한 다이어그램도 감지하여 제거

#### 2.3 문서 완성도 확인 및 마무리
**구현**: `ensureDocumentCompletion()` 함수 추가
- 마지막 5줄 확인
- 불완전한 문장 패턴 감지
- 불완전한 문장 제거 후 마무리 문장 추가

**효과**:
- 완전한 문서 보장
- 불완전한 문장 자동 수정

---

## 📊 개선 전후 비교

| 항목 | 개선 전 | 개선 후 |
|------|---------|---------|
| 섹션 중복 | 자주 발생 | 방지됨 |
| Mermaid 중복 | 자주 발생 | 방지됨 |
| Mermaid 크기 | 너무 큼 (8개 노드, 10자) | 적절함 (6개 노드, 8자) |
| 스크롤 발생 | 자주 발생 | 방지됨 |
| 섹션 번호 | 뒤엉킴 | 정규화됨 |
| 문서 완성도 | 불완전 | 완전함 |

---

## 🔧 구현된 함수

### 새로운 함수들

1. **`extractWrittenSections(parts: string[]): string[]`**
   - 이전 부분에서 작성된 섹션 목록 추출

2. **`extractWrittenMermaidDiagrams(parts: string[]): string[]`**
   - 이전 부분에서 작성된 Mermaid 다이어그램 추출

3. **`normalizeSectionNumbers(content: string): string`**
   - 섹션 번호 정규화

4. **`removeDuplicateMermaidDiagrams(content: string): string`**
   - Mermaid 다이어그램 중복 제거 (유사도 기반)

5. **`calculateSimilarity(str1: string, str2: string): number`**
   - 두 문자열의 유사도 계산 (Jaccard 유사도)

6. **`ensureDocumentCompletion(content: string): string`**
   - 문서 완성도 확인 및 마무리

---

## 🧪 테스트 필요 사항

1. **PRD 생성 테스트**
   - 실제 아이디어로 PRD 생성
   - 섹션 중복 확인
   - Mermaid 다이어그램 중복 확인
   - 섹션 번호 일관성 확인
   - 문서 완성도 확인

2. **Mermaid 다이어그램 크기 확인**
   - 노드 개수 6개 이하 확인
   - 노드 텍스트 8자 이하 확인
   - 레벨 2단계 이하 확인
   - 스크롤 없이 전체 구조 표시 확인

3. **문서 완성도 확인**
   - 문서가 완전한 문장으로 끝나는지 확인
   - 불완전한 문장이 없는지 확인

---

## 📝 변경된 파일

- `src/services/ai.ts`
  - `buildPRDPrompt()` 함수 개선
  - `mergePRDParts()` 함수 개선
  - 새로운 헬퍼 함수들 추가

---

## 🚀 다음 단계

1. 실제 PRD 생성 테스트
2. 사용자 피드백 수집
3. 필요 시 추가 개선

---

**작성자**: AI Assistant  
**최종 업데이트**: 2025년 12월 3일

